import"./bootstrap.esm-434bcbc7.js";import{b as E}from"./axios-61e5193b.js";import{u as P}from"./userStore-61de1e54.js";import{v as V}from"./runtime-dom.esm-bundler-466e0a51.js";import{b7 as B,aw as L,ak as n,m as r,n as e,F as h,au as g,aK as l,t as w,a4 as _,u as m,b2 as f,b4 as T}from"./plugin-vueexport-helper-6c478766.js";import"./index-f28331f7.js";const{VITE_APIPATH:O,VITE_URL:k}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"panduola666",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},A={data(){return{orders:[],currentOrder:{},pagination:{}}},computed:{},methods:{...E(P,["checkLogin"]),changePage(o){this.pagination.current_page!==o&&this.getOrders(o)},getOrders(o=1){this.$http.get(`${k}/api/${O}/admin/orders?page=${o}`).then(a=>{const{orders:i,pagination:p}=a.data;this.orders=i,this.pagination=p})},togglePaid(o,a){this.$refs.toggleBtn.forEach(i=>i.disabled=!0),this.$http.put(`${k}/api/${O}/admin/order/${o}`,{data:a}).then(i=>{alert(i.data.message),this.$refs.toggleBtn.forEach(p=>p.disabled=!1),this.getOrders()})},deleteOrder(o){this.$refs.deleteOrderBtn.forEach(a=>a.disabled=!0),this.$http.delete(`${k}/api/${O}/admin/order/${o}`).then(a=>{alert(a.data.message),this.getOrders(this.pagination.current_page),this.$refs.deleteOrderBtn.forEach(i=>i.disabled=!1)})}},mounted(){this.checkLogin(),this.getOrders(this.$route.query.page)}},D={class:"table table-hover text-center"},I=e("thead",null,[e("tr",null,[e("th"),e("th",null,"購買品項"),e("th",null,"付款狀態"),e("th",null,"應付款金額"),e("th")])],-1),M=["onClick"],U={class:"text-center"},q=["name","id","onUpdate:modelValue","onChange"],N=["for"],R=["onClick"],S={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},H={class:"modal-content"},$=e("div",{class:"modal-header bg-dark"},[e("h5",{class:"modal-title fs-4 text-white",id:"exampleModalLabel"}," 訂單詳情 "),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body row"},z={class:"col-3"},K=e("p",{class:"fs-4"},"用戶資訊",-1),G={class:"col border-start"},J=e("p",{class:"fs-4"},"訂單資訊",-1),Q={class:"row"},W={class:"col"},X={class:"col fw-bold"},Y=e("p",{class:"mb-0"},"訂單留言：",-1),Z={class:"p-2 border"},ee={class:"col-12 border-top pt-5"},te={class:"table table-bordered border-dark table-hover align-middle text-center"},se=e("caption",null," 購買細項 ",-1),le=e("thead",null,[e("tr",null,[e("th",null,"商品編號"),e("th",null,"品項"),e("th",null,"數量"),e("th",null,"金額")])],-1),ae={class:"fw-bolder fs-5"},oe=e("td",{colspan:"3",class:"text-end"},"總計",-1),ne=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ")],-1),re={"aria-label":"Page navigation example"},ie={class:"pagination justify-content-center"},de={class:"page-item"},ce=e("span",{"aria-hidden":"true"},"«",-1),ue={class:"page-item"},_e=e("span",{"aria-hidden":"true"},"»",-1);function pe(o,a,i,p,s,c){var x,v,y,C;const b=L("router-link");return n(),r("div",null,[e("table",D,[I,e("tbody",null,[(n(!0),r(h,null,g(s.orders,(t,d)=>(n(),r("tr",{class:"align-middle",key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-close",onClick:()=>c.deleteOrder(t.id),ref_for:!0,ref:"deleteOrderBtn"},null,8,M)]),e("td",null,[(n(!0),r(h,null,g(t.products,u=>(n(),r("p",{key:u.id,class:"mb-0"},l(u.product.title)+" * "+l(u.qty),1))),128))]),e("td",U,[T(e("input",{type:"checkbox",name:`is_paid${d}`,id:`is_paid${d}`,class:"me-2",style:{transform:"scale(1.3)"},"onUpdate:modelValue":u=>t.is_paid=u,onChange:()=>c.togglePaid(t.id,t),ref_for:!0,ref:"toggleBtn"},null,40,q),[[V,t.is_paid]]),e("label",{for:`is_paid${d}`,class:_({"text-danger":!t.is_paid,"text-success fw-bold fs-5":t.is_paid})},l(t.is_paid?"已付款":"尚未付款"),11,N)]),e("td",null,l(t.total),1),e("td",null,[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-toggle":"modal","data-bs-target":"#exampleModal",onClick:()=>s.currentOrder=t}," 訂單詳情 ",8,R)])]))),128))])]),e("div",S,[e("div",F,[e("div",H,[$,e("div",j,[e("div",z,[K,e("p",null,"購買人："+l((x=s.currentOrder.user)==null?void 0:x.name),1),e("p",null,"電話："+l((v=s.currentOrder.user)==null?void 0:v.tel),1),e("p",null,"信箱："+l((y=s.currentOrder.user)==null?void 0:y.email),1),e("p",null,"地址："+l((C=s.currentOrder.user)==null?void 0:C.address),1)]),e("div",G,[J,e("div",Q,[e("p",W," 成立時間："+l(new Date(s.currentOrder.create_at*1e3).toLocaleString()),1),e("p",X,[w(" 付款狀態："),e("span",{class:_({"text-danger":!s.currentOrder.is_paid,"text-success":s.currentOrder.is_paid})},l(s.currentOrder.is_paid?"已付款":"尚未付款"),3)])]),Y,e("p",Z,l(s.currentOrder.message?s.currentOrder.message:"無"),1)]),e("div",ee,[e("table",te,[se,le,e("tbody",null,[(n(!0),r(h,null,g(s.currentOrder.products,(t,d)=>(n(),r("tr",{key:t.id},[e("td",null,l(d),1),e("td",null,l(t.product.title),1),e("td",null,l(t.qty),1),e("td",null,l(t.total),1)]))),128))]),e("tfoot",null,[e("tr",ae,[oe,e("td",null,l(s.currentOrder.total),1)])])])])]),ne])])]),e("nav",re,[e("ul",ie,[e("li",de,[m(b,{to:`/admin/orders?page=${s.pagination.current_page-1}`,class:_(["page-link",{disabled:!s.pagination.has_pre}]),"aria-label":"Previous",onClick:a[0]||(a[0]=()=>c.getOrders(s.pagination.current_page-1))},{default:f(()=>[ce]),_:1},8,["to","class"])]),(n(!0),r(h,null,g(s.pagination.total_pages,(t,d)=>(n(),r("li",{class:_(["page-item",{active:+this.$route.query.page===t}]),key:d},[m(b,{to:`/admin/orders?page=${t}`,class:"page-link",onClick:()=>c.changePage(t)},{default:f(()=>[w(l(t),1)]),_:2},1032,["to","onClick"])],2))),128)),e("li",ue,[m(b,{to:`/admin/orders?page=${s.pagination.current_page+1}`,class:_(["page-link",{disabled:!s.pagination.has_next}]),"aria-label":"Next",onClick:a[1]||(a[1]=()=>c.getOrders(s.pagination.current_page+1))},{default:f(()=>[_e]),_:1},8,["to","class"])])])])])}const ke=B(A,[["render",pe]]);export{ke as default};
